$.bt_validate.method("pass_eq",function(a){return($("#login_password").val()==$("#confirm_password").val())},"两次输入的密码不一致");$("#register_form").bt_validate();$(document).ready(function(){$("#register_submit").click(function(a){doReg();a.preventDefault()});$("#register_verified_code,#register_verified_refresh").click(function(a){a.preventDefault();$("#register_verified_code").attr("src","/account/login/authcode/"+Math.random())});$("#login_username").bind({blur:function(){verifyUsername()},focus:function(){$("#login_username").parent().siblings("p").hide()}});$("#login_username").change(function(){$("#register_verified_code").attr("src","/account/login/authcode/"+Math.random())});$("#phonecode").bind({blur:function(){verifyPhonecode()},focus:function(){$("#sendVerifyCode").parent().siblings("p").hide()}});$("#authcode").bind({blur:function(){},focus:function(){$(".tipauthcode").hide();$(".tipphonecode").hide()}});$("#login_password").bind({blur:function(){verifyPassword()},focus:function(){$(this).parent().siblings("p").hide();return true}});$("#confirm_password").bind({blur:function(){verifyConfirmPassword()},focus:function(){$(this).parent().siblings("p").hide();return true}});$("#isagree").bind({click:function(){verifyAgree()}});bindSendMobileVerifyCode()});var _agt=_agt||[];function ag_635532_pvkl_ats101(){_agt=[];_agt.push(["_atscu","AG_635532_PVKL"]);_agt.push(["_atsdomain","miabaobei.com"]);_agt.push(["_atsev","101"]);_agt.push(["_atsusr",$("#login_username").val()]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=(document.location.protocol=="https:"?"https":"http")+"://t.agrantsem.com/js/ag.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})()}function track(){_adwq.push(["_setAction","7p32ud",$("#login_username").val()]);var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=(document.location.protocol=="https:"?"https":"http")+"://d.emarbox.com/js/adw_mia.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}var tprm="";function doReg(){if(checkRegisterForm()&&checkAuthCode()){$("#register_submit").unbind("click");var a=$("#url").val();if(a==""||typeof(a)=="undefined"){a="/"}$.ajax({type:"POST",url:"/instant/account/registerService",dataType:"json",data:$("#register_form").serialize(),success:function(c){if(c.code==1){tprm="uid99="+$("#login_username").val();ag_635532_pvkl_ats101();track();window.location.href=a}else{$("#register_verified_code").attr("src","/account/login/authcode/"+Math.random());if(c.code==-1){var b=$(".tipauthcode");b.find(".tipcon").text(c.msg).show();b.show()}else{if(c.code==-2){$("#sendVerifyCode").parent().parent().find("p").removeClass("usermassge").addClass("usermassge1").html(getTipHtml(c.msg,"")).show()}else{$("#confirm_password").parent().parent().find("p").html(getTipHtml(c.msg,"")).show()}}$("#register_submit").click(function(){doReg()})}}})}else{$("#register_submit").toggleClass("shake-horizontal shake");setTimeout("removeShake()",500)}return false}function removeShake(){$("#register_submit").toggleClass("shake shake-horizontal")}function checkAuthCode(){return true;var a=$.trim($("#authcode").val());var b=/^[0-9a-zA-Z]{4,6}$/;if(a!=""&&b.test(a)){return true}else{$(".registerErrorNotice").text("验证码错误").show();return false}}function checkUsername(a){$(".noticWrap p").empty().hide();var b=$("#login_username").val();$.ajax({type:"POST",url:"/instant/account/checkForCell",data:"cell="+b,dataType:"json",success:function(c){if(c.code==1){$("#login_username").parent().parent().find("p").html(getTipHtml("此手机号已被占用","")).show();return false}else{$("#login_username").parent().parent().find("p").empty().hide();return true}}})}function checkRegisterForm(){var e=verifyUsername();var d=verifyPhonecode();var c=verifyPassword();var a=verifyConfirmPassword();var b=verifyAgree();if(!e){return false}if(!d){return false}if(!c){return false}if(!a){return false}if(!b){return false}$.bt_validate.result=true;$.bt_validate.form.find("input[validate],select[validate],textarea[validate]").trigger("blur");if($.bt_validate.blocked){return false}return $.bt_validate.result}var InterValObj;var count=60;var curCount;var code="";var codeLength=4;function sendMessage(b){curCount=count;var d=$("#authcode").val();var a=$(".tipauthcode");var e=$(".tipauthcode .tipcon");for(var c=0;c<codeLength;c++){code+=parseInt(Math.random()*9).toString()}$.ajax({type:"POST",dataType:"json",url:"/instant/account/getMobileVerifyCode",data:"code="+code+"&cell="+b+"&authcode="+d,success:function(g){var f="";if(g.code==2){a.show();e.text(g.msg).show();$("#register_verified_code").attr("src","/account/login/authcode")}else{if(g.code==1){$("#sendVerifyCode").text(curCount+"秒后重新获取");$("#sendVerifyCode").unbind();InterValObj=window.setInterval(SetRemainTime,1000);f="tipmessagebg";$("#sendVerifyCode").parent().parent().find("p").removeClass("usermassge1").addClass("usermassge").html(getTipHtml(g.msg,f)).show()}else{window.clearInterval(InterValObj);$("#sendVerifyCode").text("重新发送短信验证码");bindSendMobileVerifyCode();$("#login_username").parent().parent().find("p").html(getTipHtml(g.msg,f)).show()}}}})}function SetRemainTime(){if(curCount==0){window.clearInterval(InterValObj);$("#verifyPart .sendCode").attr("id","sendVerifyCode");$("#sendVerifyCode").text("重新发送短信验证码");bindSendMobileVerifyCode();code=""}else{curCount--;$("#sendVerifyCode").text(curCount+"秒后重新获取")}}function bindSendMobileVerifyCode(){var a=$(".tipauthcode");var b=a.find(".tipcon");a.hide();b.text("").hide();$("#sendVerifyCode").bind("click",function(d){d.preventDefault();var h=$("#login_username");var g=$.trim(h.val());if(/^((13[0-9])|(15[0-9])|(14[57])|(17[0-9])|(18[0-9]))\d{8}$/.test(g)){}else{var f="请输入正确的手机号码，且为11位纯数字格式";h.parent().parent().find("p").html(getTipHtml(f,"")).show();return false}var c=$("#authcode").val();if(!c){a.show();b.text("验证码不能为空").show();return false}sendMessage(g)})}function getTipHtml(d,a){var c="tipnamebg";if(a){c=a}var b='<span  class="tipcon">'+d+"</span>";b+='<span class="rownotice"><img src="/resources/images/'+c+'.png"></span>';return b}function verifyUsername(){var a=$("#login_username");var c=$.trim(a.val());if(/^((13[0-9])|(15[0-9])|(14[57])|(17[0-9])|(18[0-9]))\d{8}$/.test(c)){return true}else{var b="请输入正确的手机号码，且为11位纯数字格式";a.parent().parent().find("p").html(getTipHtml(b,"")).show();return false}}function verifyPhonecode(){var b=$("#phonecode");var a=$.trim(b.val());if(!a){$("#sendVerifyCode").parent().parent().find("p").removeClass("usermassge").addClass("usermassge1").html(getTipHtml("短信验证码不能为空","")).show();return false}return true}function verifyPassword(){var b=$("#login_password");var a=true;if(b.val().length<6||b.val().length>14){b.parent().siblings("p").html(getTipHtml("长度为6-14个字符，建议使用字母加数字或符号组合","")).show();a=false}return a}function verifyConfirmPassword(){var b=$("#login_password");var c=$("#confirm_password");var a=true;if(c.val().length<6||c.val().length>14){c.parent().siblings("p").html(getTipHtml("长度为6-14个字符，建议使用字母加数字或符号组合","")).show();a=false}if(b.val()!=c.val()){c.parent().siblings("p").html(getTipHtml("两次输入的密码不一致","")).show();a=false}return a}function verifyAgree(){if(!$("#isagree").attr("checked")){$("#isagree").siblings("p").show();return false}$("#isagree").siblings("p").hide();return true};