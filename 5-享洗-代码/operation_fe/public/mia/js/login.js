$("#login_form").bt_validate();$(document).ready(function(){$("#login_submit").click(function(){doLogin();return false});$("#authcode").focus(function(){$(".authcode").hide()});$("#phonecode").focus(function(){$(".mb").hide()});$("#login_verified_code,#login_verified_refresh").click(function(a){a.preventDefault();$("#login_verified_code").attr("src","/account/login/authcode/"+Math.random())});$(window).keydown(function(a){switch(a.keyCode){case 13:doLogin();break}})});function doLogin(){if(checkLoginForm()&&checkAuthCode()){var a=$("#url").val();if(a==""||typeof(a)=="undefined"){a="/"}$.ajax({type:"POST",url:"/instant/account/loginService",dataType:"json",data:$("#login_form").serialize(),success:function(b){if(b.code==1){window.location.href=a}else{$("#verityGroup").attr("data-hidden",0).show();$("#login_verified_code").attr("src","/account/login/authcode/"+Math.random());$(".loginNotice").empty().hide();var c=$(".loginErrorNotice");if(b.msg=="验证码错误"){c.eq(1).text(b.msg).show()}else{if(b.msg.indexOf("短信验证码")!=-1){c.eq(2).text(b.msg).show()}else{c.eq(0).text(b.msg).show()}}}}})}}function checkAuthCode(){if($("#verityGroup").attr("data-hidden")==1){return true}var a=$.trim($("#authcode").val());var b=/^[0-9a-zA-Z]{4,6}$/;if(a!=""&&b.test(a)){return true}else{$(".loginErrorNotice.cd").text("验证码错误").show();return false}}function checkLoginForm(){$.bt_validate.result=true;$.bt_validate.form.find("input[validate],select[validate],textarea[validate]").trigger("blur");if($.bt_validate.blocked){return false}return $.bt_validate.result}var InterValObj;var count=60;var curCount;var code="";var codeLength=4;var is_click=0;$("#sendVerifyCodeLogin").bind("click",function(b){console.log(111);if(is_click==1){return false}b.preventDefault();var f=$("#login_username");var d=$.trim(f.val());if(/^((13[0-9])|(15[0-9])|(14[57])|(17[0-9])|(18[0-9]))\d{8}$/.test(d)){}else{var c="请输入正确的手机号码，且为11位纯数字格式";f.parent().parent().find("p").html(getTipHtml(c,"")).show();return false}var a=$("#authcode").val();if(!a){$(".tipauthcode").show();$(".tipauthcode .tipcon").text("验证码不能为空").show();return false}sendMessageLogin(d)});function sendMessageLogin(b){curCount=count;var d=$("#authcode").val();var a=$(".tipauthcode");var e=$(".tipauthcode .tipcon");for(var c=0;c<codeLength;c++){code+=parseInt(Math.random()*9).toString()}$.ajax({type:"POST",dataType:"json",url:"/instant/account/getMobileVerifyCodeLogin",data:"code="+code+"&cell="+b+"&authcode="+d,success:function(g){var f="";if(g.code==2){a.show();e.text(g.msg).show();$("#login_verified_code").attr("src","/account/login/authcode")}else{if(g.code==1){$("#sendVerifyCodeLogin").text(curCount+"秒后重新获取");is_click=1;InterValObj=window.setInterval(SetRemainTime,1000);f="tipmessagebg";$("#sendVerifyCodeLogin").parent().parent().children("p").removeClass("usermassge1").addClass("usermassge").html(getTipHtml(g.msg,f)).show();window.setTimeout(function(){$(".usermassge").hide()},1000)}else{window.clearInterval(InterValObj);$("#sendVerifyCodeLogin").text("重新发送短信验证码");is_click=0;$("#login_username").parent().parent().find("p").html(getTipHtml(g.msg,f)).show()}}}})}function SetRemainTime(){if(curCount==0){window.clearInterval(InterValObj);$("#sendVerifyCodeLogin").text("重新发送短信验证码");is_click=0;code=""}else{curCount--;$("#sendVerifyCodeLogin").text(curCount+"秒后重新获取")}}function getTipHtml(d,a){var c="tipnamebg";if(a){c=a}var b='<span  class="tipcon">'+d+"</span>";b+='<span class="rownotice"><img src="/resources/images/'+c+'.png"></span>';return b};