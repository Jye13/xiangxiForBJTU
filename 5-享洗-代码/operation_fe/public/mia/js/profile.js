jQuery(document).ready(function(a){a("#upateUserInfo").click(function(b){deoEditUserInfo()})});function deoEditUserInfo(){var c=$.trim($("input[name=nickname]").val());var b=$.trim($("input[name=child_birth_day]").val());var a=$.trim($("input[name=relation]:checked").val());$(".err_nickname").text("");$.ajax({url:"/home/profile/setUserInfo",type:"POST",data:{nickname:c,child_birth_day:b,relation:a},success:function(d){if(d=="success"){alert("修改成功！")}else{if(d=="nologin"||d=="faild"){alert("修改失败！")}else{if(d=="repeat_nickname"){$(".err_nickname").text("昵称已经存在！");return false}else{alert(d)}}}window.location.reload()}})}var cut_div;var cut_img;var imgdefw;var imgdefh;var offsetx=83;var offsety=-194;var divx=286;var divy=266;var cutx=120;var cuty=120;var zoom=1;var zmin=0.1;var zmax=10;function SImage(c){var a=new Image();this.img=a;var b=navigator.appName.toLowerCase();if(b.indexOf("netscape")==-1){a.onreadystatechange=function(){if(a.readyState=="complete"){imgwidth=a.width;imgheight=a.height;if(imgwidth<cutx||imgheight<cuty){alert("您上传的图片尺寸太小，请重新上传！");return false}c(a)}}}else{a.onload=function(){if(a.complete==true){imgwidth=a.width;imgheight=a.height;if(imgwidth<cutx||imgheight<cuty){alert("您上传的图片尺寸太小，请重新上传！");return false}c(a)}}}}SImage.prototype.get=function(a){this.img.src=a+"?rn="+Math.random()};function imageinit(a){cut_div=document.getElementById("cut_div");cut_img=document.getElementById("cut_img");if(a){cut_img.src="";cut_img.src=a.src;imgdefw=a.width;imgdefh=a.height}else{imgdefw=$(cut_img).width();imgdefh=$(cut_img).height()}if(imgdefw>parseInt(divx)){zoom=parseInt(divx)/imgdefw;$(cut_img).width(parseInt(divx));$(cut_img).height(Math.round(imgdefh*zoom))}$(cut_img).css("left",Math.round((divx-cut_img.width)/2));$(cut_img).css("top",Math.round((divy-cut_img.height)/2)-divy);if(imgdefw>cutx){zmin=cutx/imgdefw}else{zmin=1}zmax=zmin>0.25?8:4/Math.sqrt(zmin);if(imgdefw>cutx){zmin=cutx/imgdefw}else{zmin=1}Drag.init(cut_div,cut_img);cut_img.onDrag=when_Drag}function imageresize(a){var b=0;if(a){b=zoom*1.5}else{b=zoom/1.5}if(b<zmin){b=zmin}if(b>zmax){b=zmax}if(Math.round(imgdefw*b)>=cutx&&Math.round(imgdefh*b)>=cuty){zoom=b;$(cut_img).width(Math.round(imgdefw*zoom));$(cut_img).height(Math.round(imgdefh*zoom))}checkcutpos()}function getStylepos(a){return{x:parseInt($(a).css("left")),y:parseInt($(a).css("top"))}}function getPosition(c){var b=c.offsetTop;var a=c.offsetLeft;while(c=c.offsetParent){b+=c.offsetTop;a+=c.offsetLeft}return{x:a,y:b}}function checkcutpos(){var a=getStylepos(cut_img);max_x=Math.max(offsetx,offsetx+cutx-cut_img.clientWidth);min_x=Math.min(offsetx+cutx-cut_img.clientWidth,offsetx);if(a.x>max_x){cut_img.style.left=max_x+"px"}else{if(a.x<min_x){cut_img.style.left=min_x+"px"}}max_y=Math.max(offsety,offsety+cuty-cut_img.clientHeight);min_y=Math.min(offsety+cuty-cut_img.clientHeight,offsety);if(a.y>max_y){cut_img.style.top=max_y+"px"}else{if(a.y<min_y){cut_img.style.top=min_y+"px"}}}function when_Drag(b,a){checkcutpos()}function uploadIconSuccess(b,d){var c=img_cdn_url+b;var a=new SImage(imageinit);a.get(c);$("#img_base_path").val(b)}function initUpload(){UploadApp.init("id_upload_img_index","image_index",0,1,"*.jpg;*.gif;*.png","jpg，png，gif图片","user_icon",resource,uploadIconSuccess)}function docut(){var g=getStylepos(cut_img);var b=offsetx-g.x;var f=offsety-g.y;var c=$(cut_img).width();var a=$(cut_img).height();var d=$("#img_base_path").val();if(c<=0||a<=0){alert("图片错误！");return false}$.ajax({url:"http://uploads.miabaobei.com/image_cut.php",type:"GET",dataType:"jsonp",data:{x:b,y:f,width:c,height:a,resourceid:resource,resource_type:"user_icon",image:d},success:function(h){if(h.res==false){if(h.data=="no_post_resourceid"){alert("用户ID有误！")}else{if(h.data=="wrong_resourcetype"){alert("裁切的图片类型有误！")}else{if(h.data=="wrong_resize"){alert("裁切的图片大小有误！")}else{if(h.data=="no_post_image"||h.data=="havent_image"||h.data=="isnt_image"){alert("指定裁切的图片有误！")}else{if(h.data=="resize_error"||h.data=="cut_error"||h.data=="save_error"){alert("裁切图片失败！")}}}}}}else{e(h.data)}}});function e(h){if(!h){return false}$.ajax({url:"/instant/profile/saveIcon/",type:"POST",dataType:"json",data:{userId:resource,icon:h},success:function(i){if(i.res==false){alert("设置头像失败！");return false}else{alert("设置成功！");window.location.href=historyUrl}}})}};